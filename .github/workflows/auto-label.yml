name: Auto Label

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  label:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Label issues
        if: github.event_name == 'issues'
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body?.toLowerCase() || '';
            const labels = [];
            
            // Bug detection
            if (title.includes('[bug]') || title.includes('bug:') || body.includes('bug')) {
              labels.push('bug');
            }
            
            // Feature detection
            if (title.includes('[feature]') || title.includes('feature:') || body.includes('feature request')) {
              labels.push('enhancement');
            }
            
            // Question detection
            if (title.includes('[question]') || title.includes('question:') || title.includes('how to')) {
              labels.push('question');
            }
            
            // Documentation
            if (title.includes('docs') || title.includes('documentation')) {
              labels.push('documentation');
            }
            
            // Good first issue detection
            if (title.includes('good first issue') || body.includes('good first issue')) {
              labels.push('good first issue');
            }
            
            // Add labels if any were detected
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                labels: labels
              });
            }

      - name: Label PRs
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title.toLowerCase();
            const body = context.payload.pull_request.body?.toLowerCase() || '';
            const labels = [];
            
            // Type detection
            if (title.includes('feat:') || title.includes('feature:')) {
              labels.push('enhancement');
            }
            if (title.includes('fix:') || title.includes('bug:')) {
              labels.push('bug');
            }
            if (title.includes('docs:') || title.includes('documentation:')) {
              labels.push('documentation');
            }
            if (title.includes('refactor:')) {
              labels.push('refactoring');
            }
            if (title.includes('test:')) {
              labels.push('tests');
            }
            if (title.includes('chore:')) {
              labels.push('chore');
            }
            if (title.includes('perf:') || title.includes('performance:')) {
              labels.push('performance');
            }
            
            // Breaking change detection
            if (body.includes('breaking change') || body.includes('[x] ðŸ’¥ breaking change')) {
              labels.push('breaking change');
            }
            
            // Add labels if any were detected
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                labels: labels
              });
            }
